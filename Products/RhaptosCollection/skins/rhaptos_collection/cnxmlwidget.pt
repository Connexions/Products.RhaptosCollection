<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="rhaptos">
  <tal:comment>
    Customization of textareawidget to consume and display additional validation information,
    such as is generated by CNXML validation. This happens only in the edit block. The 'ul'
    below is the extent of the customization. We reconstruct the edit bit of textarea macro,
    which nicely has its contents available in macros, since textarea doesn't give us a good slot,
    but field does.
    
    This looks for a list of error messages in an error field of fieldname+'msg', usually 'abstractmsg'.
    These are displayed in the ul.
  </tal:comment>

  <body>

    <!-- Like parent TextArea Widgets -->
    <span class="field" metal:define-macro="view">
      <metal:use use-macro="here/widgets/textarea/macros/view">
      </metal:use>
    </span>

    <metal:define define-macro="edit"
                  tal:define="textarea here/widgets/textarea/macros">
      <metal:use use-macro="field_macro | here/widgets/field/macros/edit">
        <div metal:fill-slot="widget_body">
          <ul tal:define="errormsg python:errors.get(fieldName+'msg')"
              tal:condition="errormsg">
            <li tal:repeat="msg errormsg"
                tal:content="python:msg[1]">
              attribute not allowed
            </li>
          </ul>
          <metal:block use-macro="textarea/area_edit" />
          <metal:block use-macro="textarea/area_format" />
        </div>
      </metal:use>
    </metal:define>

    <div metal:define-macro="search">
      <div metal:use-macro="here/widgets/textarea/macros/edit">
      </div>
    </div>

  </body>

</html>
